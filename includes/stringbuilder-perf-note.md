<span data-ttu-id="9b27b-101">使用基于字符的索引与<xref:System.Text.StringBuilder.Chars%2A>属性可以是以下情况下执行速度极慢：</span><span class="sxs-lookup"><span data-stu-id="9b27b-101">Using character-based indexing with the <xref:System.Text.StringBuilder.Chars%2A> property can be extremely slow under the following conditions:</span></span>

- <span data-ttu-id="9b27b-102"><xref:System.Text.StringBuilder>实例是大 （例如，它由组成的几个数万个字符）。</span><span class="sxs-lookup"><span data-stu-id="9b27b-102">The <xref:System.Text.StringBuilder> instance is large (for example, it consists of several tens of thousands of characters).</span></span>
- <span data-ttu-id="9b27b-103"><xref:System.Text.StringBuilder>是"块区"。</span><span class="sxs-lookup"><span data-stu-id="9b27b-103">The <xref:System.Text.StringBuilder> is "chunky."</span></span> <span data-ttu-id="9b27b-104">也就是说，如重复对方法的调用<xref:System.Text.StringBuilder.Append%2A?displayProperty=nameWithType>已自动扩展对象的<xref:System.Text.StringBuilder.Capacity%2A?displayProperty=nameWithType>属性和分配新到它的内存块。</span><span class="sxs-lookup"><span data-stu-id="9b27b-104">That is, repeated calls to methods such as <xref:System.Text.StringBuilder.Append%2A?displayProperty=nameWithType> have automatically expanded the object's <xref:System.Text.StringBuilder.Capacity%2A?displayProperty=nameWithType> property and allocated new chunks of memory to it.</span></span>

<span data-ttu-id="9b27b-105">因为每个字符访问指导区块以查找正确的缓冲区进行到索引的整个链接的列表会严重影响性能。</span><span class="sxs-lookup"><span data-stu-id="9b27b-105">Performance is severely impacted because each character access walks the entire linked list of chunks to find the correct buffer to index into.</span></span>

> [!NOTE]
>  <span data-ttu-id="9b27b-106">即使对于大型大批量<xref:System.Text.StringBuilder>对象、 使用<xref:System.Text.StringBuilder.Chars%2A>以便基于索引的访问一个或少量的字符的属性会影响可以忽略不计性能; 通常情况下，它是**0 （n)**操作。</span><span class="sxs-lookup"><span data-stu-id="9b27b-106">Even for a large "chunky" <xref:System.Text.StringBuilder> object, using the <xref:System.Text.StringBuilder.Chars%2A> property for index-based access to one or a small number of characters has a negligible performance impact; typically, it is an **0(n)** operation.</span></span> <span data-ttu-id="9b27b-107">当循环中的字符，则会发生显著的性能影响<xref:System.Text.StringBuilder>对象，它是**O(n^2)**操作。</span><span class="sxs-lookup"><span data-stu-id="9b27b-107">The significant performance impact occurs when iterating the characters in the <xref:System.Text.StringBuilder> object, which is an **O(n^2)** operation.</span></span> 

<span data-ttu-id="9b27b-108">如果你遇到性能问题时使用基于字符的索引与<xref:System.Text.StringBuilder>对象，你可以使用任何下列解决方法：</span><span class="sxs-lookup"><span data-stu-id="9b27b-108">If you encounter performance issues when using character-based indexing with <xref:System.Text.StringBuilder> objects, you can use any of the following workarounds:</span></span>

- <span data-ttu-id="9b27b-109">将转换<xref:System.Text.StringBuilder>到实例<xref:System.String>通过调用<xref:System.Text.StringBuilder.ToString%2A>方法，然后访问字符串中的字符。</span><span class="sxs-lookup"><span data-stu-id="9b27b-109">Convert the <xref:System.Text.StringBuilder> instance to a <xref:System.String> by calling the <xref:System.Text.StringBuilder.ToString%2A> method, then access the characters in the string.</span></span>

- <span data-ttu-id="9b27b-110">将现有的内容复制<xref:System.Text.StringBuilder>到新的对象预大小<xref:System.Text.StringBuilder>对象。</span><span class="sxs-lookup"><span data-stu-id="9b27b-110">Copy the contents of the existing <xref:System.Text.StringBuilder> object to a new pre-sized <xref:System.Text.StringBuilder> object.</span></span> <span data-ttu-id="9b27b-111">可以提高性能，因为新<xref:System.Text.StringBuilder>对象不是块式。</span><span class="sxs-lookup"><span data-stu-id="9b27b-111">Performance improves because the new <xref:System.Text.StringBuilder> object is not chunky.</span></span> <span data-ttu-id="9b27b-112">例如:</span><span class="sxs-lookup"><span data-stu-id="9b27b-112">For example:</span></span>

   ```csharp
   // sbOriginal is the existing StringBuilder object
   var sbNew = new StringBuilder(sbOriginal.ToString(), sbOriginal.Length);
   ```
   ```vb
   ' sbOriginal is the existing StringBuilder object
   Dim sbNew = New StringBuilder(sbOriginal.ToString(), sbOriginal.Length)
   ```
- <span data-ttu-id="9b27b-113">设置的初始容量<xref:System.Text.StringBuilder>到通过调用约等于其最大的预期大小的值的对象<xref:System.Text.StringBuilder.%23ctor(System.Int32)>构造函数。</span><span class="sxs-lookup"><span data-stu-id="9b27b-113">Set the initial capacity of the <xref:System.Text.StringBuilder> object to a value that is approximately equal to its maximum expected size by calling the <xref:System.Text.StringBuilder.%23ctor(System.Int32)> constructor.</span></span> <span data-ttu-id="9b27b-114">请注意此分配的内存，即使整个块<xref:System.Text.StringBuilder>很少达到其最大容量。</span><span class="sxs-lookup"><span data-stu-id="9b27b-114">Note that this allocates the entire block of memory even if the <xref:System.Text.StringBuilder> rarely reaches its maximum capacity.</span></span>
