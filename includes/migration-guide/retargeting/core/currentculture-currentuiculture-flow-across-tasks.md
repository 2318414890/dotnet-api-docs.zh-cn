### <a name="currentculture-and-currentuiculture-flow-across-tasks"></a><span data-ttu-id="1803c-101">在任务之间的 CurrentCulture 和 CurrentUICulture 流</span><span class="sxs-lookup"><span data-stu-id="1803c-101">CurrentCulture and CurrentUICulture flow across tasks</span></span>

|   |   |
|---|---|
|<span data-ttu-id="1803c-102">详细信息</span><span class="sxs-lookup"><span data-stu-id="1803c-102">Details</span></span>|<span data-ttu-id="1803c-103">从.NET Framework 4.6，开始<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>和<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>存储在线程的<xref:System.Threading.ExecutionContext?displayProperty=name>，在异步操作的流动。这意味着，更改为<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>或<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>将会反映在更高版本以异步方式运行的任务。</span><span class="sxs-lookup"><span data-stu-id="1803c-103">Beginning in the .NET Framework 4.6, <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> are stored in the thread's <xref:System.Threading.ExecutionContext?displayProperty=name>, which flows across asynchronous operations.This means that changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> will be reflected in tasks which are later run asynchronously.</span></span> <span data-ttu-id="1803c-104">这是从以前的.NET Framework 版本的行为不同 (这将重置<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>和<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>所有异步任务中)。</span><span class="sxs-lookup"><span data-stu-id="1803c-104">This is different from the behavior of previous .NET Framework versions (which would reset <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> in all asynchronous tasks).</span></span>|
|<span data-ttu-id="1803c-105">建议</span><span class="sxs-lookup"><span data-stu-id="1803c-105">Suggestion</span></span>|<span data-ttu-id="1803c-106">此更改影响的应用可能会解决这个问题通过显式设置所需<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>或<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>作为异步任务中的第一个操作。</span><span class="sxs-lookup"><span data-stu-id="1803c-106">Apps affected by this change may work around it by explicitly setting the desired <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> as the first operation in an async Task.</span></span> <span data-ttu-id="1803c-107">或者，这一旧行为 (不使<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> / <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>) 可能通过设置以下的兼容性开关参加：</span><span class="sxs-lookup"><span data-stu-id="1803c-107">Alternatively, the old behavior (of not flowing <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>) may be opted into by setting the following compatibility switch:</span></span><pre><code class="language-C#">AppContext.SetSwitch(&quot;Switch.System.Globalization.NoAsyncCurrentCulture&quot;, true);&#13;&#10;</code></pre><span data-ttu-id="1803c-108">.NET Framework 4.6.2 中的 WPF 的已修复此问题。</span><span class="sxs-lookup"><span data-stu-id="1803c-108">This issue has been fixed by WPF in .NET Framework 4.6.2.</span></span> <span data-ttu-id="1803c-109">它还中已修复了.NET 框架 4.6，通过 4.6.1 [KB 3139549](https://support.microsoft.com/kb/3139549)。</span><span class="sxs-lookup"><span data-stu-id="1803c-109">It has also been fixed in .NET Frameworks 4.6, 4.6.1 through [KB 3139549](https://support.microsoft.com/kb/3139549).</span></span> <span data-ttu-id="1803c-110">面向 4.6 或更高版本的.NET 应用程序将自动获得正确的行为在 WPF 应用程序- <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> / <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>) 将保留在调度程序操作。</span><span class="sxs-lookup"><span data-stu-id="1803c-110">Applications targeting .NET 4.6 or later will automatically get the right behavior in WPF applications - <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>) would be preserved across Dispatcher operations.</span></span>|
|<span data-ttu-id="1803c-111">范围</span><span class="sxs-lookup"><span data-stu-id="1803c-111">Scope</span></span>|<span data-ttu-id="1803c-112">次要</span><span class="sxs-lookup"><span data-stu-id="1803c-112">Minor</span></span>|
|<span data-ttu-id="1803c-113">版本</span><span class="sxs-lookup"><span data-stu-id="1803c-113">Version</span></span>|<span data-ttu-id="1803c-114">4.6</span><span class="sxs-lookup"><span data-stu-id="1803c-114">4.6</span></span>|
|<span data-ttu-id="1803c-115">类型</span><span class="sxs-lookup"><span data-stu-id="1803c-115">Type</span></span>|<span data-ttu-id="1803c-116">重定目标</span><span class="sxs-lookup"><span data-stu-id="1803c-116">Retargeting</span></span>|
|<span data-ttu-id="1803c-117">受影响的 API</span><span class="sxs-lookup"><span data-stu-id="1803c-117">Affected APIs</span></span>|<ul><li><xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=nameWithType></li><li><xref:System.Threading.Thread.CurrentCulture?displayProperty=nameWithType></li><li><xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=nameWithType></li><li><xref:System.Threading.Thread.CurrentUICulture?displayProperty=nameWithType></li></ul>|

